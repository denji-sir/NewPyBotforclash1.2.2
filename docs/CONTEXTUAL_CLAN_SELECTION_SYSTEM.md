# –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∫–ª–∞–Ω–æ–≤ NewPyBot v1.2.2

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

**–£–º–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä** - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–ª–∞–Ω –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Å–ø–æ—Ä—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—Ä–∏ —ç—Ç–æ–º –ø–æ–∑–≤–æ–ª—è—è –ª–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–ª–∞–Ω–∞–º–∏ —á–∞—Ç–∞.

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

1. üéØ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** - –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –ø–∞—Å–ø–æ—Ä—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –µ–≥–æ –∫–ª–∞–Ω–∞
2. üî¢ **–ü—Ä–æ—Å—Ç–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∫ –∫–æ–º–∞–Ω–¥–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥—Ä—É–≥–æ–≥–æ –∫–ª–∞–Ω–∞  
3. ‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** - –∫–∞–∂–¥—ã–π —á–∞—Ç –∏–º–µ–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω –¥–ª—è –Ω–µ–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. üìã **–ü–æ–Ω—è—Ç–Ω–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è** - –∫–ª–∞–Ω—ã –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω—ã –≤ –ø–æ—Ä—è–¥–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
5. üé® **–£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤—Å–µ–≥–¥–∞ –≤–∏–¥—è—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–ª–∞–Ω–æ–≤

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î

```sql
-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∞–Ω–æ–≤ –¥–ª—è —á–∞—Ç–æ–≤  
CREATE TABLE chat_clan_settings (
    id SERIAL PRIMARY KEY,
    chat_id BIGINT NOT NULL,
    registered_clan_id INTEGER NOT NULL,  -- ID –∏–∑ registered_clans
    clan_number INTEGER NOT NULL,         -- –ù–æ–º–µ—Ä –∫–ª–∞–Ω–∞ –≤ —á–∞—Ç–µ (1, 2, 3...)
    is_default BOOLEAN DEFAULT FALSE,     -- –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω —á–∞—Ç–∞
    display_name VARCHAR(100),            -- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    added_at TIMESTAMP DEFAULT NOW(),
    added_by BIGINT NOT NULL,            -- –ö—Ç–æ –¥–æ–±–∞–≤–∏–ª –∫–ª–∞–Ω –≤ —á–∞—Ç
    
    UNIQUE(chat_id, clan_number),        -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –≤ —á–∞—Ç–µ
    UNIQUE(chat_id, registered_clan_id), -- –ö–ª–∞–Ω –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤–∞–∂–¥—ã –≤ –æ–¥–Ω–æ–º —á–∞—Ç–µ
    FOREIGN KEY (registered_clan_id) REFERENCES registered_clans(id) ON DELETE CASCADE,
    INDEX idx_chat_clans (chat_id, clan_number),
    INDEX idx_default_clan (chat_id, is_default)
);

-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –∫–µ—à–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞–Ω–∞—Ö –≤ —á–∞—Ç–∞—Ö
CREATE TABLE chat_clan_cache (
    id SERIAL PRIMARY KEY,
    chat_id BIGINT NOT NULL,
    clan_number INTEGER NOT NULL,
    clan_tag VARCHAR(15) NOT NULL,
    clan_name VARCHAR(100) NOT NULL,
    member_count INTEGER DEFAULT 0,
    last_updated TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(chat_id, clan_number),
    INDEX idx_chat_cache (chat_id)
);
```

### –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –∫–ª–∞–Ω–∞

```python
class ClanContextManager:
    def __init__(self, db_connection):
        self.db = db_connection
        
    async def resolve_clan_context(self, chat_id: int, user_id: int, 
                                 explicit_number: Optional[int] = None) -> Dict:
        """
        –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –∫–ª–∞–Ω–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã
        
        –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
        1. –Ø–≤–Ω–æ —É–∫–∞–∑–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä –∫–ª–∞–Ω–∞ (explicit_number)
        2. –ö–ª–∞–Ω –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Å–ø–æ—Ä—Ç)
        3. –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω —á–∞—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
        """
        
        # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–ª–∞–Ω–æ–≤ —á–∞—Ç–∞
        chat_clans = await self.get_chat_clans(chat_id)
        
        if not chat_clans:
            raise ValueError("–í —ç—Ç–æ–º —á–∞—Ç–µ –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∞–Ω–æ–≤")
            
        # 1. –Ø–≤–Ω–æ —É–∫–∞–∑–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä –∫–ª–∞–Ω–∞
        if explicit_number is not None:
            if explicit_number < 1 or explicit_number > len(chat_clans):
                raise ValueError(f"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –∫–ª–∞–Ω–∞. –î–æ—Å—Ç—É–ø–Ω—ã: 1-{len(chat_clans)}")
                
            selected_clan = chat_clans[explicit_number - 1]
            return {
                'clan_tag': selected_clan['clan_tag'],
                'clan_name': selected_clan['clan_name'],
                'selection_method': 'explicit',
                'clan_number': explicit_number,
                'available_clans': chat_clans
            }
        
        # 2. –ö–ª–∞–Ω –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        user_clan = await self.get_user_clan_context(user_id, chat_clans)
        if user_clan:
            return user_clan
            
        # 3. –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω —á–∞—Ç–∞
        default_clan = next((clan for clan in chat_clans if clan['is_default']), chat_clans[0])
        
        return {
            'clan_tag': default_clan['clan_tag'],
            'clan_name': default_clan['clan_name'],
            'selection_method': 'default',
            'clan_number': default_clan['clan_number'],
            'available_clans': chat_clans
        }
    
    async def get_user_clan_context(self, user_id: int, chat_clans: List[Dict]) -> Optional[Dict]:
        """–ü–æ–ª—É—á–∏—Ç—å –∫–ª–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ –ø–∞—Å–ø–æ—Ä—Ç–∞"""
        
        # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        user_binding = await self.db.fetch_one("""
            SELECT player_tag, clan_tag FROM user_player_bindings 
            WHERE user_id = ? AND is_active = TRUE
        """, (user_id,))
        
        if not user_binding:
            return None
            
        # –ò—â–µ–º –∫–ª–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ä–µ–¥–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤ —á–∞—Ç–µ
        user_clan_tag = user_binding['clan_tag']
        
        for clan in chat_clans:
            if clan['clan_tag'] == user_clan_tag:
                return {
                    'clan_tag': clan['clan_tag'],
                    'clan_name': clan['clan_name'], 
                    'selection_method': 'user_clan',
                    'clan_number': clan['clan_number'],
                    'available_clans': chat_clans,
                    'user_player_tag': user_binding['player_tag']
                }
        
        return None
    
    async def get_chat_clans(self, chat_id: int) -> List[Dict]:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∞–Ω–æ–≤ —á–∞—Ç–∞"""
        
        return await self.db.fetch_all("""
            SELECT 
                ccs.clan_number,
                ccs.is_default,
                ccs.display_name,
                rc.clan_tag,
                rc.clan_name,
                rc.id as registered_clan_id
            FROM chat_clan_settings ccs
            JOIN registered_clans rc ON ccs.registered_clan_id = rc.id
            WHERE ccs.chat_id = ? AND rc.is_active = TRUE
            ORDER BY ccs.clan_number ASC
        """, (chat_id,))
```

---

## üéÆ –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º –≤—ã–±–æ—Ä–æ–º

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

#### `/wars` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ–π–Ω
```python
async def cmd_wars(message: Message):
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ–π–Ω —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –∫–ª–∞–Ω–∞"""
    
    # –ü–∞—Ä—Å–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥—ã
    args = message.text.split()[1:]
    clan_number = None
    
    if args and args[0].isdigit():
        clan_number = int(args[0])
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –∫–ª–∞–Ω
    try:
        clan_context = await clan_manager.resolve_clan_context(
            message.chat.id, 
            message.from_user.id, 
            clan_number
        )
    except ValueError as e:
        await message.reply(str(e))
        return
    
    # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–æ–π–Ω –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–ª–∞–Ω–∞
    wars_data = await get_clan_wars_stats(clan_context['clan_tag'])
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
    text = f"""
‚öîÔ∏è **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ–π–Ω**
üè∞ **{clan_context['clan_name']}** (#{clan_context['clan_number']})

üìä **–¢–µ–∫—É—â–∏–µ –≤–æ–π–Ω—ã:**
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ–π–Ω: {wars_data['active_wars']}
‚Ä¢ –°—Ç–∞—Ç—É—Å: {wars_data['war_status']}
‚Ä¢ –î–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è: {wars_data['time_remaining']}

üìà **–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
‚Ä¢ –ü–æ–±–µ–¥: {wars_data['wins']} 
‚Ä¢ –ü–æ—Ä–∞–∂–µ–Ω–∏–π: {wars_data['losses']}
‚Ä¢ –í–∏–Ω—Ä–µ–π—Ç: {wars_data['win_rate']:.1f}%

üë• **–£—á–∞—Å—Ç–∏–µ:**
‚Ä¢ –ê—Ç–∞–∫ —Å–¥–µ–ª–∞–Ω–æ: {wars_data['attacks_used']}/{wars_data['attacks_total']}
‚Ä¢ –ó–≤–µ–∑–¥ –ø–æ–ª—É—á–µ–Ω–æ: {wars_data['stars_earned']}
‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è: {wars_data['destruction_percentage']:.1f}%
"""
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–ª–∞–Ω–∞—Ö
    if len(clan_context['available_clans']) > 1:
        text += f"\nüî¢ **–î—Ä—É–≥–∏–µ –∫–ª–∞–Ω—ã:**\n"
        for clan in clan_context['available_clans']:
            if clan['clan_number'] != clan_context['clan_number']:
                text += f"‚Ä¢ {clan['clan_number']}. {clan['clan_name']}\n"
        text += f"\nüí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/wars {'{–Ω–æ–º–µ—Ä}'}` –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –∫–ª–∞–Ω–∞"
    
    await message.reply(text, parse_mode='Markdown')
```

#### `/raids` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Capital Raids
```python
async def cmd_raids(message: Message):
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Capital Raids —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º –≤—ã–±–æ—Ä–æ–º"""
    
    args = message.text.split()[1:]
    clan_number = None
    
    if args and args[0].isdigit():
        clan_number = int(args[0])
    
    clan_context = await clan_manager.resolve_clan_context(
        message.chat.id, message.from_user.id, clan_number
    )
    
    raids_data = await get_clan_capital_raids_stats(clan_context['clan_tag'])
    
    # –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –ø–∞—Å–ø–æ—Ä—Ç–æ–≤
    personal_stats = ""
    if clan_context.get('user_player_tag'):
        user_raids = await get_player_raids_stats(clan_context['user_player_tag'])
        personal_stats = f"""
üë§ **–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
‚Ä¢ –ê—Ç–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: {user_raids['attacks_used']}/6
‚Ä¢ –£—Ä–æ–Ω –Ω–∞–Ω–µ—Å–µ–Ω: {user_raids['damage_dealt']:,}
‚Ä¢ –ú–µ—Å—Ç–æ –≤ –∫–ª–∞–Ω–µ: {user_raids['clan_rank']}
"""
    
    text = f"""
üèõÔ∏è **Capital Raids**
üè∞ **{clan_context['clan_name']}** (#{clan_context['clan_number']})

üìä **–¢–µ–∫—É—â–∏–π —Ä–µ–π–¥:**
‚Ä¢ –°—Ç–∞—Ç—É—Å: {raids_data['current_status']}
‚Ä¢ –†–∞–π–æ–Ω–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: {raids_data['districts_completed']}/6
‚Ä¢ –û–±—â–∏–π —É—Ä–æ–Ω: {raids_data['total_damage']:,}
‚Ä¢ –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {raids_data['participants']}

üèÜ **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
‚Ä¢ Capital Gold –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: {raids_data['gold_earned']:,}
‚Ä¢ –†–µ–π–¥ –º–µ–¥–∞–ª–∏: {raids_data['raid_medals']}
‚Ä¢ –ú–µ—Å—Ç–æ —Å—Ä–µ–¥–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤: {raids_data['leaderboard_position']}

{personal_stats}

üíé **Capital Hall:** –£—Ä–æ–≤–µ–Ω—å {raids_data['capital_hall_level']}
"""
    
    if len(clan_context['available_clans']) > 1:
        text += f"\nüî¢ –î—Ä—É–≥–∏–µ –∫–ª–∞–Ω—ã: "
        other_clans = [str(c['clan_number']) for c in clan_context['available_clans'] 
                      if c['clan_number'] != clan_context['clan_number']]
        text += ", ".join(other_clans)
        text += f" | `/raids {'{–Ω–æ–º–µ—Ä}'}`"
    
    await message.reply(text, parse_mode='Markdown')
```

### –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### `/set_default_clan <–Ω–æ–º–µ—Ä>` - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞–Ω–∞
```python
async def cmd_set_default_clan(message: Message):
    """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞–Ω–∞ —á–∞—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)"""
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    if not await is_chat_admin(message.from_user.id, message.chat.id):
        await message.reply("–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω —á–∞—Ç–∞")
        return
    
    args = message.text.split()[1:]
    if not args or not args[0].isdigit():
        await message.reply("–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–ª–∞–Ω–∞: `/set_default_clan 2`")
        return
    
    clan_number = int(args[0])
    
    # –ü–æ–ª—É—á–∞–µ–º –∫–ª–∞–Ω—ã —á–∞—Ç–∞
    chat_clans = await clan_manager.get_chat_clans(message.chat.id)
    
    if clan_number < 1 or clan_number > len(chat_clans):
        await message.reply(f"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä. –î–æ—Å—Ç—É–ø–Ω—ã: 1-{len(chat_clans)}")
        return
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω
    await clan_manager.set_default_clan(message.chat.id, clan_number)
    
    selected_clan = next(c for c in chat_clans if c['clan_number'] == clan_number)
    
    await message.reply(f"""
‚úÖ **–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω –æ–±–Ω–æ–≤–ª–µ–Ω**

üè∞ **{selected_clan['clan_name']}** —Ç–µ–ø–µ—Ä—å –∫–ª–∞–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

üí° –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ –ø–∞—Å–ø–æ—Ä—Ç–∞ –±—É–¥—É—Ç –≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —ç—Ç–æ–≥–æ –∫–ª–∞–Ω–∞
    """, parse_mode='Markdown')
```

#### `/add_clan_to_chat <—Ç–µ–≥_–∫–ª–∞–Ω–∞>` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–Ω–∞ –≤ —á–∞—Ç
```python
async def cmd_add_clan_to_chat(message: Message):
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∞–Ω–∞ –≤ —á–∞—Ç"""
    
    if not await is_chat_admin(message.from_user.id, message.chat.id):
        await message.reply("–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∫–ª–∞–Ω—ã –≤ —á–∞—Ç")
        return
    
    args = message.text.split()[1:]
    if not args:
        await message.reply("–£–∫–∞–∂–∏—Ç–µ —Ç–µ–≥ –∫–ª–∞–Ω–∞: `/add_clan_to_chat #ABC123`")
        return
    
    clan_tag = args[0].upper()
    if not clan_tag.startswith('#'):
        clan_tag = '#' + clan_tag
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∞–Ω –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
    registered_clan = await get_registered_clan_by_tag(clan_tag)
    if not registered_clan:
        await message.reply(f"–ö–ª–∞–Ω {clan_tag} –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ")
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∞–Ω –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç
    existing_clans = await clan_manager.get_chat_clans(message.chat.id)
    if any(c['clan_tag'] == clan_tag for c in existing_clans):
        await message.reply(f"–ö–ª–∞–Ω {clan_tag} —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —ç—Ç–æ—Ç —á–∞—Ç")
        return
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞–Ω –≤ —á–∞—Ç
    clan_number = len(existing_clans) + 1
    is_default = len(existing_clans) == 0  # –ü–µ—Ä–≤—ã–π –∫–ª–∞–Ω - –æ—Å–Ω–æ–≤–Ω–æ–π
    
    await clan_manager.add_clan_to_chat(
        message.chat.id, 
        registered_clan['id'], 
        clan_number,
        is_default,
        message.from_user.id
    )
    
    await message.reply(f"""
‚úÖ **–ö–ª–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç**

üè∞ **{registered_clan['clan_name']}** ({clan_tag})
üî¢ –ù–æ–º–µ—Ä –≤ —á–∞—Ç–µ: **{clan_number}**
{'‚≠ê –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω' if is_default else ''}

üí° –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
‚Ä¢ `/wars {clan_number}` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ–π–Ω
‚Ä¢ `/raids {clan_number}` - Capital Raids  
‚Ä¢ `/members {clan_number}` - —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–ª–∞–Ω–∞
    """, parse_mode='Markdown')
```

---

## üìã –°–∏—Å—Ç–µ–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–ª–∞–Ω–æ–≤

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### `/clans` - –°–ø–∏—Å–æ–∫ –∫–ª–∞–Ω–æ–≤ —á–∞—Ç–∞
```python
async def cmd_clans(message: Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–ª–∞–Ω—ã, –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫ —á–∞—Ç—É"""
    
    chat_clans = await clan_manager.get_chat_clans(message.chat.id)
    
    if not chat_clans:
        await message.reply("""
‚ùå **–í —ç—Ç–æ–º —á–∞—Ç–µ –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–ª–∞–Ω–æ–≤**

üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∞–Ω—ã:
‚Ä¢ `/add_clan_to_chat #TAG` - –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∞–Ω
‚Ä¢ `/register_clan #TAG` - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª–∞–Ω
        """)
        return
    
    # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞–Ω–∞
    clan_stats = []
    for clan in chat_clans:
        stats = await get_basic_clan_stats(clan['clan_tag'])
        clan_stats.append({**clan, **stats})
    
    text = f"üè∞ **–ö–ª–∞–Ω—ã —á–∞—Ç–∞** ({len(chat_clans)})\n\n"
    
    for clan in clan_stats:
        default_marker = "‚≠ê " if clan['is_default'] else ""
        text += f"""
{default_marker}**{clan['clan_number']}. {clan['clan_name']}**
‚Ä¢ –¢–µ–≥: `{clan['clan_tag']}`
‚Ä¢ –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {clan['member_count']}/50
‚Ä¢ –û—á–∫–æ–≤: {clan['clan_points']:,}
‚Ä¢ –õ–∏–≥–∞: {clan['war_league']}
"""
    
    text += f"""
üí° **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
‚Ä¢ `/wars` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ–π–Ω –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞–Ω–∞
‚Ä¢ `/wars 2` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ–π–Ω –∫–ª–∞–Ω–∞ ‚Ññ2
‚Ä¢ `/raids 3` - Capital Raids –∫–ª–∞–Ω–∞ ‚Ññ3

üéØ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä:**
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø–∞—Å–ø–æ—Ä—Ç, –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∞—à–µ–≥–æ –∫–ª–∞–Ω–∞
    """
    
    await message.reply(text, parse_mode='Markdown')
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –ø–∞—Å–ø–æ—Ä—Ç–æ–≤

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –ø–∞—Å–ø–æ—Ä—Ç–∞
```python
async def cmd_my_passport(message: Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Å–ø–æ—Ä—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ"""
    
    user_id = message.from_user.id
    passport = await get_user_passport(user_id)
    
    if not passport:
        await message.reply("–£ –≤–∞—Å –Ω–µ—Ç –ø–∞—Å–ø–æ—Ä—Ç–∞. –°–æ–∑–¥–∞—Ç—å: /create_passport")
        return
    
    # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–º –∏–≥—Ä–æ–∫–µ
    binding = await get_user_binding(user_id)
    
    text = f"""
üìã **–ú–æ–π –ø–∞—Å–ø–æ—Ä—Ç**
üë§ **{binding['player_name']}** ‚úÖ (`{binding['player_tag']}`)
üè∞ –ö–ª–∞–Ω: **{binding['clan_name']}** (`{binding['clan_tag']}`)

üéØ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:**
–ö–æ–≥–¥–∞ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∫–æ–º–∞–Ω–¥—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –±–µ–∑ –Ω–æ–º–µ—Ä–∞ –∫–ª–∞–Ω–∞, 
–±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∂–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ –∫–ª–∞–Ω–∞.

üìä **–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
‚Ä¢ `/my_profile` - –º–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞
‚Ä¢ `/my_progress` - –º–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å
‚Ä¢ `/wars` - –≤–æ–π–Ω—ã –º–æ–µ–≥–æ –∫–ª–∞–Ω–∞
‚Ä¢ `/raids` - —Ä–µ–π–¥—ã –º–æ–µ–≥–æ –∫–ª–∞–Ω–∞

üî¢ **–î—Ä—É–≥–∏–µ –∫–ª–∞–Ω—ã —á–∞—Ç–∞:**
–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä –∫ –∫–æ–º–∞–Ω–¥–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥—Ä—É–≥–∏—Ö –∫–ª–∞–Ω–æ–≤
–ù–∞–ø—Ä–∏–º–µ—Ä: `/wars 2`, `/raids 3`
"""
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª–∞–Ω—ã –≤ —Ç–µ–∫—É—â–µ–º —á–∞—Ç–µ
    chat_clans = await clan_manager.get_chat_clans(message.chat.id)
    if len(chat_clans) > 1:
        text += f"\nüè∞ **–ö–ª–∞–Ω—ã –≤ —ç—Ç–æ–º —á–∞—Ç–µ:**\n"
        for clan in chat_clans:
            marker = "üë§" if clan['clan_tag'] == binding['clan_tag'] else "üî¢"
            text += f"{marker} {clan['clan_number']}. {clan['clan_name']}\n"
    
    await message.reply(text, parse_mode='Markdown')
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥

```python
class ClanContextMiddleware:
    """Middleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫–ª–∞–Ω–∞"""
    
    def __init__(self, clan_manager: ClanContextManager):
        self.clan_manager = clan_manager
        
    async def __call__(self, handler, event: Message, data: Dict):
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∫–ª–∞–Ω–∞"""
        
        # –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫–ª–∞–Ω–∞
        clan_context_commands = [
            'wars', 'raids', 'members', 'donations', 'clan_stats', 
            'war_log', 'capital_log', 'top_players'
        ]
        
        command = event.text.split()[0][1:] if event.text.startswith('/') else None
        
        if command in clan_context_commands:
            try:
                # –ü–∞—Ä—Å–∏–º –Ω–æ–º–µ—Ä –∫–ª–∞–Ω–∞ –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
                args = event.text.split()[1:]
                explicit_number = None
                
                if args and args[0].isdigit():
                    explicit_number = int(args[0])
                    # –£–¥–∞–ª—è–µ–º –Ω–æ–º–µ—Ä –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
                    event.text = ' '.join([event.text.split()[0]] + args[1:])
                
                # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫–ª–∞–Ω–∞
                clan_context = await self.clan_manager.resolve_clan_context(
                    event.chat.id, 
                    event.from_user.id, 
                    explicit_number
                )
                
                # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ data –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ handler'–µ
                data['clan_context'] = clan_context
                
            except ValueError as e:
                await event.reply(str(e))
                return
        
        # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
        return await handler(event, data)
```

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∞–Ω–æ–≤

```python
class ClanCacheManager:
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –¥–∞–Ω–Ω—ã—Ö –∫–ª–∞–Ω–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞"""
    
    def __init__(self, redis_client, db_connection):
        self.redis = redis_client
        self.db = db_connection
        
    async def get_cached_clan_info(self, chat_id: int) -> List[Dict]:
        """–ü–æ–ª—É—á–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∞–Ω–∞—Ö —á–∞—Ç–∞"""
        
        cache_key = f"chat_clans:{chat_id}"
        cached_data = await self.redis.get(cache_key)
        
        if cached_data:
            return json.loads(cached_data)
        
        # –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫–µ—à–µ, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î
        clan_data = await self._load_clan_data_from_db(chat_id)
        
        # –ö–µ—à–∏—Ä—É–µ–º –Ω–∞ 1 —á–∞—Å
        await self.redis.setex(
            cache_key, 
            3600, 
            json.dumps(clan_data, default=str)
        )
        
        return clan_data
    
    async def _load_clan_data_from_db(self, chat_id: int) -> List[Dict]:
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∞–Ω–æ–≤ –∏–∑ –ë–î —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π"""
        
        chat_clans = await self.db.fetch_all("""
            SELECT 
                ccs.clan_number,
                ccs.is_default,
                rc.clan_tag,
                rc.clan_name,
                rc.last_updated
            FROM chat_clan_settings ccs
            JOIN registered_clans rc ON ccs.registered_clan_id = rc.id
            WHERE ccs.chat_id = ? AND rc.is_active = TRUE
            ORDER BY ccs.clan_number ASC
        """, (chat_id,))
        
        # –û–±–æ–≥–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ API (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å)
        enriched_clans = []
        for clan in chat_clans:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∞–Ω–∞
            if self._needs_update(clan['last_updated']):
                fresh_data = await self._fetch_clan_from_api(clan['clan_tag'])
                if fresh_data:
                    await self._update_clan_in_db(clan['clan_tag'], fresh_data)
                    enriched_clans.append({**clan, **fresh_data})
                else:
                    enriched_clans.append(clan)
            else:
                enriched_clans.append(clan)
                
        return enriched_clans
    
    def _needs_update(self, last_updated: datetime) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∞–Ω–∞"""
        return datetime.now() - last_updated > timedelta(hours=6)
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üéØ **–£–º–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** - –Ω–µ –Ω—É–∂–Ω–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ —É–∫–∞–∑—ã–≤–∞—Ç—å —Å–≤–æ–π –∫–ª–∞–Ω
- üî¢ **–ü—Ä–æ—Å—Ç–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** - –ª–µ–≥–∫–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥—Ä—É–≥–∏—Ö –∫–ª–∞–Ω–æ–≤
- üì± **–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ—Å—Ç—å** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–≥–∏—á–Ω–æ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ
- üé® **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–æ, –∫–∞–∫–æ–π –∫–ª–∞–Ω –≤—ã–±—Ä–∞–Ω

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- ‚öôÔ∏è **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** - –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω —á–∞—Ç–∞
- üìä **–ö–æ–Ω—Ç—Ä–æ–ª—å** - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —É–ø—Ä–∞–≤–ª—è—é—Ç —Å–ø–∏—Å–∫–æ–º –∫–ª–∞–Ω–æ–≤
- üîß **–ü—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞–Ω–æ–≤ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã

### –î–ª—è —Å–∏—Å—Ç–µ–º—ã
- üöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∞–Ω–æ–≤
- üìà **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∫–ª–∞–Ω–æ–≤ –≤ —á–∞—Ç–µ  
- üîÑ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ø–∞—Å–ø–æ—Ä—Ç–∞–º–∏ –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- ‚ö° **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - graceful fallback –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –±–æ—Ç–æ–º –Ω–∞–º–Ω–æ–≥–æ —É–¥–æ–±–Ω–µ–µ –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–µ–µ! üöÄ