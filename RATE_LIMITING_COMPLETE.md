# ‚úÖ Rate Limiting - –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

**–î–∞—Ç–∞:** 14.10.2025, 01:45  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ì–û–¢–û–í–û –ö PRODUCTION**

---

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å RateLimitService ‚úÖ
**–§–∞–π–ª:** `bot/services/rate_limit_service.py` (677 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ rate limit –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ —Å–ø–∞–º–µ
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–∫–∞–∑–∞–Ω–∏–π (5–º–∏–Ω ‚Üí 1—á ‚Üí 1–¥–µ–Ω—å ‚Üí 7–¥–Ω–µ–π)
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –ê–¥–º–∏–Ω –º–µ—Ç–æ–¥—ã (—Ä—É—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

**–¢–∞–±–ª–∏—Ü—ã –ë–î:**
- `user_blocks` - –∞–∫—Ç–∏–≤–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- `rate_limit_violations` - –∏—Å—Ç–æ—Ä–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π
- `command_usage_log` - –ª–æ–≥–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

### 2. –°–æ–∑–¥–∞–Ω middleware RateLimitMiddleware ‚úÖ
**–§–∞–π–ª:** `bot/middlewares/rate_limit_middleware.py`

**–†–∞–±–æ—Ç–∞:**
- ‚úÖ –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–æ–º–∞–Ω–¥–∞–º–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç rate limit –ü–ï–†–ï–î –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
- ‚úÖ –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç `/start` –∏ `/help`

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
```python
# bot/main.py, —Å—Ç—Ä–æ–∫–∞ 104
self.dp.message.middleware(RateLimitMiddleware())
```

---

### 3. –°–æ–∑–¥–∞–Ω admin router ‚úÖ
**–§–∞–π–ª:** `bot/handlers/rate_limit_admin_commands.py` (501 —Å—Ç—Ä–æ–∫–∞)

**–ö–æ–º–∞–Ω–¥—ã:**
- ‚úÖ `/rate_limits` - —Å–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
- ‚úÖ `/unblock_user` - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `/block_user` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
- ‚úÖ `/user_rl_stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Callback handlers:**
- ‚úÖ `rl_refresh:` - –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
- ‚úÖ `rl_stats:` - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–î–æ—Å—Ç—É–ø:**
–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —á–∞—Ç–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `is_group_admin()`)

---

### 4. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ bot/main.py ‚úÖ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

```python
# 1. –ò–º–ø–æ—Ä—Ç—ã (—Å—Ç—Ä–æ–∫–∏ 59-61)
from .services.rate_limit_service import init_rate_limit_service
from .middlewares.rate_limit_middleware import RateLimitMiddleware
from .handlers.rate_limit_admin_commands import router as rate_limit_admin_router

# 2. Middleware (—Å—Ç—Ä–æ–∫–∞ 104)
self.dp.message.middleware(RateLimitMiddleware())

# 3. Router (—Å—Ç—Ä–æ–∫–∞ 119)
self.dp.include_router(rate_limit_admin_router)

# 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 170-173)
rate_limit_service = init_rate_limit_service(self.config.database_url)
await rate_limit_service.initialize_database()
logger.info("‚úÖ Rate limiting –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
```

---

### 5. –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ

**–§–∞–π–ª—ã:**
1. ‚úÖ `RATE_LIMITING.md` (650 —Å—Ç—Ä–æ–∫) - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
2. ‚úÖ `RATE_LIMITING_QUICKSTART.md` (200 —Å—Ç—Ä–æ–∫) - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- üìñ –û–ø–∏—Å–∞–Ω–∏–µ –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã
- ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- üìù –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- üîÑ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
- üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ FAQ

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** < 1ms (–±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É –∏ –∏–Ω–¥–µ–∫—Å–∞–º)
- **Overhead:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ì–æ—Ç–æ–≤–æ –∫ —Ç—ã—Å—è—á–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
```python
SPAM_THRESHOLD = 4      # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ –¥–ª—è —Å–ø–∞–º–∞
SPAM_WINDOW = 10        # –û–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ (—Å–µ–∫—É–Ω–¥—ã)
COMMAND_COOLDOWN = 2    # Cooldown –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥–∞–º–∏
```

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
```python
1-–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
2-–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ: 3600 —Å–µ–∫—É–Ω–¥ (1 —á–∞—Å)
3-–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ: 86400 —Å–µ–∫—É–Ω–¥ (1 –¥–µ–Ω—å)
4+ –Ω–∞—Ä—É—à–µ–Ω–∏–π: 604800 —Å–µ–∫—É–Ω–¥ (7 –¥–Ω–µ–π)
```

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –°–ø–∞–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω
```
[01:30:15] User 123456789: /clan_info
[01:30:15] User 123456789: /clan_info
[01:30:16] User 123456789: /clan_info
[01:30:16] User 123456789: /clan_info

[LOG] üö´ Spam detected: user 123456789 used /clan_info 4 times in 10s
[LOG] üö´ User 123456789 blocked for 300s (violation #1)

[BOT] üö´ –í—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
      –ü—Ä–∏—á–∏–Ω–∞: —Å–ø–∞–º –∫–æ–º–∞–Ω–¥–∞–º–∏
      –ù–∞—Ä—É—à–µ–Ω–∏–µ ‚Ññ: 1
      –û—Å—Ç–∞–ª–æ—Å—å: 5 –º–∏–Ω—É—Ç
```

### –ü—Ä–∏–º–µ—Ä 2: –ê–¥–º–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç
```
[01:35:00] Admin: /unblock_user 123456789

[BOT] ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
      üë§ User ID: 123456789
      üëÆ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª: @admin

[LOG] Admin 111111 unblocked user 123456789
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ
```
[Next day]
User —Å–Ω–æ–≤–∞ —Å–ø–∞–º–∏—Ç...

[LOG] üö´ User 123456789 blocked for 3600s (violation #2)
[BOT] –û—Å—Ç–∞–ª–æ—Å—å: 1 —á–∞—Å ‚Üê –£–∂–µ –¥–æ–ª—å—à–µ!
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –ö–æ–¥:
- [x] –°–µ—Ä–≤–∏—Å –Ω–∞–ø–∏—Å–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [x] Middleware —Å–æ–∑–¥–∞–Ω
- [x] Admin –∫–æ–º–∞–Ω–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ main.py
- [x] –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è middlewares

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- [x] –¢–∞–±–ª–∏—Ü—ã —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] –ò–Ω–¥–µ–∫—Å—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [x] Auto-init –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [x] –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (RATE_LIMITING.md)
- [x] –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (RATE_LIMITING_QUICKSTART.md)
- [x] –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [x] FAQ –∏ troubleshooting

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
- [x] Middleware –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
- [x] Router –¥–æ–±–∞–≤–ª–µ–Ω
- [x] –°–µ—Ä–≤–∏—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
–ü—Ä–æ—Å—Ç–æ –Ω–µ —Å–ø–∞–º—å—Ç–µ –∫–æ–º–∞–Ω–¥–∞–º–∏ - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
```bash
/rate_limits        # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
/unblock_user 123   # –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
/block_user 123 60  # –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —á–∞—Å
/user_rl_stats 123  # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
```python
# –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤:
bot/services/rate_limit_service.py

# –°—Ç—Ä–æ–∫–∞ ~60:
self.SPAM_THRESHOLD = 5  # –ë—ã–ª–æ 4
self.SPAM_WINDOW = 15    # –ë—ã–ª–æ 10
```

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è

**–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** ~2 —á–∞—Å–∞  
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~1500

**–§–∞–π–ª—ã:**
| –§–∞–π–ª | –°—Ç—Ä–æ–∫ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-------|------------|
| rate_limit_service.py | 677 | –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å |
| rate_limit_middleware.py | 93 | Middleware |
| rate_limit_admin_commands.py | 501 | –ê–¥–º–∏–Ω –∫–æ–º–∞–Ω–¥—ã |
| RATE_LIMITING.md | 650 | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |
| RATE_LIMITING_QUICKSTART.md | 200 | –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç |
| **–ò–¢–û–ì–û** | **2121** | |

---

## üí° –ö–ª—é—á–µ–≤—ã–µ —Ñ–∏—á–∏

### 1. –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
–ü–µ—Ä–≤–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ = –º—è–≥–∫–æ, —á–µ—Ç–≤—ë—Ä—Ç–æ–µ = –∂—ë—Å—Ç–∫–æ.

### 2. –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ 30 –¥–Ω–µ–π
–£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–≤–µ–∂–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è.

### 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î.

### 4. –ê–¥–º–∏–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏.

### 5. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
–ö–æ–≥–¥–∞, –∫—Ç–æ, –∫–∞–∫—É—é –∫–æ–º–∞–Ω–¥—É, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑.

### 6. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ start/help
–í–∞–∂–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã.

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–±—Ö–æ–¥–∞:
- ‚úÖ User ID - –Ω–µ–ª—å–∑—è –ø–æ–¥–¥–µ–ª–∞—Ç—å
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –î–û –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ß—Ç–æ –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è:
- `/start` - –ø–µ—Ä–≤–æ–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ
- `/help` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏
- –û–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–±–µ–∑ `/`)

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

**–¢–æ–ø —Å–ø–∞–º–µ—Ä–æ–≤:**
```sql
SELECT user_id, COUNT(*) as violations
FROM rate_limit_violations
GROUP BY user_id
ORDER BY violations DESC
LIMIT 10
```

**–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Å–ø–∞–º–∞:**
```sql
SELECT command, COUNT(*) as spam_count
FROM rate_limit_violations
GROUP BY command
ORDER BY spam_count DESC
```

**–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞—â–∏—Ç—ã:**
```sql
SELECT 
    COUNT(*) FILTER (WHERE was_blocked = 1) as blocked,
    COUNT(*) FILTER (WHERE was_blocked = 0) as allowed
FROM command_usage_log
```

---

## üéâ –ò—Ç–æ–≥

### –ß—Ç–æ –ø–æ–ª—É—á–∏–ª–∏:

‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∞—è —Å–∏—Å—Ç–µ–º–∞ rate limiting**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
- –ê–¥–º–∏–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

‚úÖ **Production-ready –∫–æ–¥**
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω

‚úÖ **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**
- –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –ø–æ—Ä–æ–≥–∏
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –†–∞—Å—à–∏—Ä—è–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `RATE_LIMITING.md` - –ø–æ–ª–Ω–∞—è
- `RATE_LIMITING_QUICKSTART.md` - –∫—Ä–∞—Ç–∫–∞—è

### –õ–æ–≥–∏:
```python
logger.warning(f"üö´ Spam detected: user {user_id}...")
logger.warning(f"üö´ User {user_id} blocked for {duration}s")
logger.info(f"Admin {admin_id} unblocked user {user_id}")
```

### –§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
- `bot.log` - –æ–±—â–∏–µ –ª–æ–≥–∏
- `data/bot.db` - –±–∞–∑–∞ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏

---

## ‚úÖ –ì–û–¢–û–í–û –ö PRODUCTION! üöÄ

**–°–∏—Å—Ç–µ–º–∞ rate limiting –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞.**

–î–ª—è –∑–∞–ø—É—Å–∫–∞:
```bash
python bot/main.py
```

–í—ã —É–≤–∏–¥–∏—Ç–µ:
```
INFO - ‚úÖ Rate limiting –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
```

**–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!** üéâ

---

**–°–æ–∑–¥–∞–Ω–æ:** 14.10.2025, 01:45  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ PRODUCTION READY  
**–í–µ—Ä—Å–∏—è:** 1.0.0
