# üö´ Rate Limiting - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## –ß—Ç–æ —ç—Ç–æ?

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –±–æ—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –∫–æ–º–∞–Ω–¥–∞–º–∏. –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è—é—Ç.

---

## üéØ –ü—Ä–∞–≤–∏–ª–∞

```
4+ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –∑–∞ 10 —Å–µ–∫—É–Ω–¥ = –ë–õ–û–ö–ò–†–û–í–ö–ê
```

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- 1-–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ: 5 –º–∏–Ω—É—Ç
- 2-–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ: 1 —á–∞—Å
- 3-–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ: 1 –¥–µ–Ω—å
- 4+ –Ω–∞—Ä—É—à–µ–Ω–∏–π: 7 –¥–Ω–µ–π

---

## üëÆ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

### `/rate_limits`
–ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```
/rate_limits
```

**–í—ã–≤–æ–¥:**
```
üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (2)

1. üö´ User ID 123456789
   –ù–∞—Ä—É—à–µ–Ω–∏–µ #2 ‚Ä¢ –û—Å—Ç–∞–ª–æ—Å—å: 45 –º–∏–Ω

2. ‚ö†Ô∏è User ID 987654321
   –ù–∞—Ä—É—à–µ–Ω–∏–µ #4 ‚Ä¢ –û—Å—Ç–∞–ª–æ—Å—å: 6 –¥–Ω
```

---

### `/unblock_user`
–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
/unblock_user 123456789
```

–∏–ª–∏ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
[Reply] /unblock_user
```

---

### `/block_user`
–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Ä—É—á–Ω—É—é

```
/block_user 123456789 60
```
‚Üë user_id ‚Üë –º–∏–Ω—É—Ç—ã

–∏–ª–∏ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
[Reply] /block_user 60
```

**–õ–∏–º–∏—Ç—ã:**
- –ú–∏–Ω–∏–º—É–º: 1 –º–∏–Ω—É—Ç–∞
- –ú–∞–∫—Å–∏–º—É–º: 10080 –º–∏–Ω—É—Ç (7 –¥–Ω–µ–π)

---

### `/user_rl_stats`
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
/user_rl_stats 123456789
```

**–í—ã–≤–æ–¥:**
```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

üë§ User ID: 123456789
‚ö†Ô∏è –í—Å–µ–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π: 3

üö´ –¢–µ–∫—É—â–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:
‚Ä¢ –ü—Ä–∏—á–∏–Ω–∞: spam_commands
‚Ä¢ –û—Å—Ç–∞–ª–æ—Å—å: 2 —á 15 –º–∏–Ω

üìÖ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ:
‚Ä¢ –î–∞—Ç–∞: 13.10.2025 23:45
‚Ä¢ –ö–æ–º–∞–Ω–¥–∞: /clan_info
‚Ä¢ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞: 1 —á
```

---

## üì± –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
/clan_info
[–∂–¥—ë—Ç 3 —Å–µ–∫]
/war
[–∂–¥—ë—Ç 5 —Å–µ–∫]
/clan_info

–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–ø–∞–º
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
/clan_info /clan_info /clan_info /clan_info

–ë–æ—Ç –ø–æ—Å–ª–µ 4-–π:
üö´ –í—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã

–ü—Ä–∏—á–∏–Ω–∞: —Å–ø–∞–º –∫–æ–º–∞–Ω–¥–∞–º–∏
–ù–∞—Ä—É—à–µ–Ω–∏–µ ‚Ññ: 1
–û—Å—Ç–∞–ª–æ—Å—å: 5 –º–∏–Ω—É—Ç

‚ö†Ô∏è –ù–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π—Ç–µ –∫–æ–º–∞–Ω–¥–∞–º–∏ –±–æ—Ç–∞!
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ê–¥–º–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç
```
–ê–¥–º–∏–Ω:
/unblock_user 123456789

–ë–æ—Ç:
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
/clan_info
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç!
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)

### –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä–æ–≥ —Å–ø–∞–º–∞:

–§–∞–π–ª: `bot/services/rate_limit_service.py` (—Å—Ç—Ä–æ–∫–∞ ~60)

```python
self.SPAM_THRESHOLD = 4   # –°–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥ = —Å–ø–∞–º
self.SPAM_WINDOW = 10     # –ó–∞ —Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
```

### –ò–∑–º–µ–Ω–∏—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

–§–∞–π–ª: `bot/services/rate_limit_service.py` (—Å—Ç—Ä–æ–∫–∞ ~20)

```python
class BlockDuration(Enum):
    SHORT = 300         # 5 –º–∏–Ω—É—Ç
    MEDIUM = 3600       # 1 —á–∞—Å
    LONG = 86400        # 1 –¥–µ–Ω—å
    WEEK = 604800       # 7 –¥–Ω–µ–π
```

---

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞—é—Ç—Å—è 3 —Ç–∞–±–ª–∏—Ü—ã:

1. **`user_blocks`** - –∞–∫—Ç–∏–≤–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
2. **`rate_limit_violations`** - –∏—Å—Ç–æ—Ä–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π
3. **`command_usage_log`** - –ª–æ–≥–∏ –∫–æ–º–∞–Ω–¥

**–ú–µ—Å—Ç–æ:** `data/bot.db`

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞!

```bash
python bot/main.py
```

**–í—ã —É–≤–∏–¥–∏—Ç–µ:**
```
INFO - ‚úÖ Rate limiting –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
```

---

## üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. `RATE_LIMITING.md` –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- API
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- FAQ
- –ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready
