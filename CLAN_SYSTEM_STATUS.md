# üè∞ –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∞–Ω–∞–º–∏

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–Ω–∞–º–∏
- ‚úÖ `/register_clan #CLANTAG` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∞–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
- ‚úÖ `/clan_list` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∞–Ω–æ–≤ —á–∞—Ç–∞
- ‚úÖ `/clan_info <–Ω–æ–º–µ—Ä>` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞–Ω–µ –ø–æ –Ω–æ–º–µ—Ä—É
- ‚úÖ `/set_default_clan <–Ω–æ–º–µ—Ä>` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞–Ω–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∞–Ω–∞ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª–∞–Ω–æ–≤ –≤ –ë–î —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ —á–∞—Ç—É

### –ö–æ–º–∞–Ω–¥—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å –æ—Å–Ω–æ–≤–Ω—ã–º –∫–ª–∞–Ω–æ–º)
- ‚úÖ `/war` - —Ç–µ–∫—É—â–∞—è –≤–æ–π–Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞–Ω–∞
- ‚úÖ `/raids` - —Ä–µ–π–¥—ã –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞–Ω–∞  
- ‚úÖ `/leadership` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞–Ω–∞
- ‚úÖ `/top_donors` - —Ç–æ–ø –¥–æ–Ω–∞—Ç–µ—Ä–æ–≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞–Ω–∞
- ‚úÖ `/cwl` - –õ–í–ö –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞–Ω–∞

---

## ‚ùå –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏)

### –î–æ—Å—Ç—É–ø –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –¥—Ä—É–≥–∏—Ö –∫–ª–∞–Ω–æ–≤
- ‚ùå `/war 2` - –≤–æ–π–Ω–∞ –∫–ª–∞–Ω–∞ ‚Ññ2 (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- ‚ùå `/raids 3` - —Ä–µ–π–¥—ã –∫–ª–∞–Ω–∞ ‚Ññ3 (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- ‚ùå `/leadership wa` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–µ—Ä–≤—ã–º –±—É–∫–≤–∞–º (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- ‚ùå –ü–∞—Ä—Å–∏–Ω–≥ –Ω–æ–º–µ—Ä–∞/–±—É–∫–≤ –∫–ª–∞–Ω–∞ –≤ –∫–æ–º–∞–Ω–¥–∞—Ö

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

### –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–ª–∞–Ω–∞ –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

```python
async def get_clan_from_args(chat_id: int, args: str = None) -> Optional[ClanInfo]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–ª–∞–Ω –ø–æ –∞—Ä–≥—É–º–µ–Ω—Ç—É –∫–æ–º–∞–Ω–¥—ã
    
    Args:
        chat_id: ID —á–∞—Ç–∞
        args: –ê—Ä–≥—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥—ã (–Ω–æ–º–µ—Ä –∏–ª–∏ –ø–µ—Ä–≤—ã–µ –±—É–∫–≤—ã)
        
    Returns:
        ClanInfo –∏–ª–∏ None
    """
    clans = await db_service.get_chat_clans(chat_id)
    
    if not clans:
        return None
    
    # –ï—Å–ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç –Ω–µ —É–∫–∞–∑–∞–Ω - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω
    if not args:
        settings = await db_service.get_chat_settings(chat_id)
        if settings.default_clan_id:
            return await db_service.get_clan_by_id(settings.default_clan_id)
        return clans[0]  # –ü–µ—Ä–≤—ã–π –∫–ª–∞–Ω
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç –Ω–æ–º–µ—Ä–æ–º
    if args.isdigit():
        clan_number = int(args)
        if 1 <= clan_number <= len(clans):
            return clans[clan_number - 1]
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –ø–µ—Ä–≤—ã–º –±—É–∫–≤–∞–º –Ω–∞–∑–≤–∞–Ω–∏—è
    args_lower = args.lower()
    for clan in clans:
        if clan.clan_name.lower().startswith(args_lower):
            return clan
    
    return None
```

### –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã

–ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª `bot/handlers/extended_clash_commands.py`:

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
1. `cmd_current_war` - `/war [–Ω–æ–º–µ—Ä|–±—É–∫–≤—ã]`
2. `cmd_capital_raids` - `/raids [–Ω–æ–º–µ—Ä|–±—É–∫–≤—ã]`
3. `cmd_leadership` - `/leadership [–Ω–æ–º–µ—Ä|–±—É–∫–≤—ã]`
4. `cmd_top_donors` - `/top_donors [–Ω–æ–º–µ—Ä|–±—É–∫–≤—ã]`

**–ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
```python
@extended_router.message(Command("war"))
async def cmd_current_war(message: Message, command: CommandObject):
    """–¢–µ–∫—É—â–∞—è –≤–æ–π–Ω–∞ –∫–ª–∞–Ω–∞"""
    
    # –ü–æ–ª—É—á–∞–µ–º –∫–ª–∞–Ω –ø–æ –∞—Ä–≥—É–º–µ–Ω—Ç—É (–Ω–æ–º–µ—Ä/–±—É–∫–≤—ã) –∏–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π
    clan = await get_clan_from_args(message.chat.id, command.args)
    
    if not clan:
        await message.reply(
            "‚ùå –ö–ª–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω!\n\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:\n"
            "‚Ä¢ `/war` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–Ω\n"
            "‚Ä¢ `/war 2` - –∫–ª–∞–Ω ‚Ññ2\n"
            "‚Ä¢ `/war wa` - –∫–ª–∞–Ω –ø–æ –ø–µ—Ä–≤—ã–º –±—É–∫–≤–∞–º\n"
            "‚Ä¢ `/clan_list` - —Å–ø–∏—Å–æ–∫ –∫–ª–∞–Ω–æ–≤"
        )
        return
    
    clan_tag = clan.clan_tag
    
    # –î–∞–ª–µ–µ –∫–æ–¥ –∫–∞–∫ —Ä–∞–Ω—å—à–µ...
```

---

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–¥–∞—á–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô**

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–ª–∞–Ω–∞–º–∏. –ë–µ–∑ –Ω–µ—ë –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–ª–∞–Ω–æ–≤ 2, 3, 4, 5.

**–í—Ä–µ–º—è –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:** 2-3 —á–∞—Å–∞

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `bot/handlers/extended_clash_commands.py` (–æ—Å–Ω–æ–≤–Ω–æ–π)
- `bot/utils/clan_helpers.py` (–¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø–∞—Ä—Å–∏–Ω–≥–∞)

---

## ‚úÖ –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

- `/war` ‚Üí –≤–æ–π–Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞–Ω–∞
- `/war 2` ‚Üí –≤–æ–π–Ω–∞ –∫–ª–∞–Ω–∞ ‚Ññ2
- `/war 3` ‚Üí –≤–æ–π–Ω–∞ –∫–ª–∞–Ω–∞ ‚Ññ3
- `/raids wa` ‚Üí —Ä–µ–π–¥—ã –∫–ª–∞–Ω–∞ "Warriors"
- `/leadership ru` ‚Üí —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∫–ª–∞–Ω–∞ "Russian"
- `/top_donors 1` ‚Üí –¥–æ–Ω–∞—Ç—ã –∫–ª–∞–Ω–∞ ‚Ññ1

**–ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —á–µ–∫-–ª–∏—Å—Ç–∞!**
